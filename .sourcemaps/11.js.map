{"version":3,"sources":["../../src/pages/login/login.module.ts","../../src/validators/email.ts","../../src/pages/login/login.ts"],"names":[],"mappings":"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","file":"11.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { LoginPage } from './login';\nimport { TranslateModule } from '@ngx-translate/core';\n\n@NgModule({\n  declarations: [\n    LoginPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(LoginPage),\n    TranslateModule.forChild(),\n  ],\n  exports: [\n    LoginPage\n  ]\n})\nexport class LoginPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/login/login.module.ts","import {FormControl} from '@angular/forms';\r\n\r\nexport class EmailValidator {\r\n\r\n    static isValid(control: FormControl){\r\n\r\n      var re = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/.test(control.value);\r\n\r\n      if (re){\r\n        return null;\r\n      }\r\n\r\n      return {\"invalidEmail\": true};\r\n    }\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/validators/email.ts","import { Component, ViewChild } from '@angular/core';\nimport { IonicPage, NavController, ToastController, Slides, MenuController } from 'ionic-angular';\nimport { Validators, FormBuilder, FormGroup, ValidationErrors } from '@angular/forms';\nimport { takeUntil } from 'rxjs/operators';\nimport { Subject } from 'rxjs/Subject';\n\nimport { AngularFireAuth } from 'angularfire2/auth';\nimport * as firebase from 'firebase/app';\n\nimport { EmailValidator } from '../../validators/email';\n\nimport { UserProvider, LoadingProvider, Translate, AlertProvider } from '../../providers';\n\n@IonicPage()\n@Component({\n  selector: 'page-login',\n  templateUrl: 'login.html'\n})\nexport class LoginPage {\n  @ViewChild(Slides) slides: Slides;\n\n  currentIndex:number = 0;\n  pushPage:any;\n  slideState: string = null;\n\n  activeMenu = 'AccountPage';\n  public signInForm: FormGroup;\n  public resetPasswordForm:FormGroup;\n  private ngUnsubscribe:Subject<void> = new Subject();\n\n  // Our translated text strings\n  private loginErrorString: string;\n\n  constructor(\n    private translate: Translate,\n    public navCtrl: NavController,\n    public afAuth: AngularFireAuth,\n    public userProvider: UserProvider,\n    public toastCtrl: ToastController,\n    private formBuilder: FormBuilder,\n    public alertProvider: AlertProvider,\n    public menuCtrl: MenuController,\n    public loadingProvider: LoadingProvider\n  ) {\n    this.menuCtrl.enable(false, 'mainMenu');\n    afAuth.authState.takeUntil(this.ngUnsubscribe).subscribe((_user: firebase.User) => {\n      if (_user) {\n        this.menuCtrl.enable(true, 'mainMenu');\n        this.navCtrl.setRoot('MainPage');\n      }\n    });\n\n    this.signInForm = formBuilder.group({\n      email: ['', Validators.compose([EmailValidator.isValid, Validators.required])],\n      password: ['', Validators.compose([Validators.required])]\n    });\n\n    this.resetPasswordForm = formBuilder.group({\n      email: ['', Validators.compose([Validators.required, EmailValidator.isValid])]\n    });\n\n    this.translate.getString('LOGIN_ERROR').takeUntil(this.ngUnsubscribe).subscribe( value => this.loginErrorString = value );\n  }\n\n  ionViewDidLeave(){\n    this.ngUnsubscribe.next();\n    this.ngUnsubscribe.complete();\n  }\n\n  slideTo(index) {\n    if (!this.slideState) {\n      this.slides.lockSwipes(false);\n      this.slides.slideTo(index);\n      this.slideState = 'moving';\n      this.slides.lockSwipes(true);\n    }\n  }\n\n  slideChanged(){\n    this.slideState = null;\n    this.currentIndex = this.slides.getActiveIndex();\n  }\n  ionViewDidLoad(){\n    this.slides.lockSwipes(true);\n  }\n\n  signInWithProvider(provider:string) {\n    this.loadingProvider.show();\n    this.userProvider.signInWithProvider(provider)\n      .then((user) => {\n\n        this.alertProvider.showSignInToast(provider + ': ' + user.displayName);\n\n        this.userProvider.afdb.object(`/users/${user.uid}`)\n          .snapshotChanges()\n          .takeUntil(this.ngUnsubscribe).subscribe((data) => {\n            // TODO: check if data.$exists()\n            if(data){\n              this.navCtrl.setRoot('MainPage');\n              this.loadingProvider.hide();\n            }else{\n              let providerData = {...user.providerData[0], ...{ aFuid: user.uid, profileImg:{}, settings : { displayName : user.displayName } } };\n              this.userProvider.addUserData(providerData).takeUntil(this.ngUnsubscribe).subscribe((data) => {\n                if(data.aFuid){\n                  this.navCtrl.setRoot('ProfilePage', {...providerData, ...{'emailVerified': true} } );\n                }else{\n                  this.alertProvider.showErrorMessage('database/generique');\n                }\n                this.loadingProvider.hide();\n              });\n\n            }\n        });\n\n      }).catch( (error) => {\n        this.loadingProvider.hide();\n        let code = error[\"code\"];\n        this.alertProvider.showErrorMessage(code);\n      });\n  }\n\n  createToast(message: string) {\n    return this.toastCtrl.create({\n      message,\n      duration: 3000\n    })\n  }\n\n  signInFormSubmit() {\n    if (!this.signInForm.valid) {\n      let errType;\n\n      Object.keys(this.signInForm.controls).forEach(key => {\n        const controlErrors: ValidationErrors = this.signInForm.get(key).errors;\n        if (controlErrors != null) {\n          Object.keys(controlErrors).forEach(keyError => {\n            errType = 'field/'+keyError;\n          });\n        }\n        console.log(errType);\n      });\n\n      this.alertProvider.showErrorMessage(errType);\n      return\n    }\n    else {\n      this.loadingProvider.show();\n\n      this.userProvider.signInUser(this.signInForm.value.email, this.signInForm.value.password)\n        .then((success) => {\n          this.loadingProvider.hide();\n          this.alertProvider.showSignInToast('email: ' + this.signInForm.value.email);\n          this.userProvider.checkEmailIsVerified();\n\n          this.navCtrl.setRoot('MainPage');\n        },\n        (error) => {\n          this.loadingProvider.hide();\n          let code = error[\"code\"];\n          this.alertProvider.showErrorMessage(code);\n        })\n    }\n  }\n\n\n  resetPassword(){\n    if (!this.resetPasswordForm.valid){\n    } else {\n      this.loadingProvider.show();\n\n      this.userProvider.resetPassword(this.resetPasswordForm.value.email)\n      .then((user) => {\n        this.loadingProvider.hide();\n\n        this.alertProvider.showPasswordResetMessage(this.resetPasswordForm.value.email);\n        this.slideTo(1);\n\n      }, (error) => {\n        this.loadingProvider.hide();\n        let code = error[\"code\"];\n        this.alertProvider.showErrorMessage(code);\n      });\n\n    }\n  }\n\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/login/login.ts"],"sourceRoot":""}