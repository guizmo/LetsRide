{"version":3,"sources":["../../src/pages/profile/profile.module.ts","../../src/pages/profile/profile.ts"],"names":[],"mappings":"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","file":"11.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { ProfilePage } from './profile';\nimport { TranslateModule } from '@ngx-translate/core';\nimport { MomentModule } from 'angular2-moment';\n\n@NgModule({\n  declarations: [\n    ProfilePage,\n  ],\n  imports: [\n    IonicPageModule.forChild(ProfilePage),\n    TranslateModule.forChild(),\n    MomentModule\n  ],\n  exports: [\n    ProfilePage\n  ]\n})\nexport class ProfilePageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/profile/profile.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams, ModalController, MenuController } from 'ionic-angular';\n\nimport { Observable } from \"rxjs/Rx\";\n\nimport { UserProvider, AlertProvider } from '../../providers';\nimport { Profile } from '../../models/profile';\nimport { DisciplinesProvider, NotificationsProvider, FileProvider } from '../../providers';\n\nimport * as firebase from 'firebase/app';\nimport * as moment  from 'moment';\n/**\n * Generated class for the ProfilePage page.\n *\n * See http://ionicframework.com/docs/components/#navigation for more info\n * on Ionic pages and navigation.\n */\n@IonicPage()\n@Component({\n  selector: 'page-profile',\n  templateUrl: 'profile.html',\n})\nexport class ProfilePage {\n\n  activeMenu = 'ProfilePage';\n  private userData:any;\n  private profileImg:string = null;\n  private profileImgLoaded:boolean = false;\n  private displayName:string = null;\n  private currentUser:firebase.User;\n  private emailVerified:boolean = false;\n  private disciplines:ReadonlyArray<any>;\n\n  constructor(\n    public navCtrl: NavController,\n    public navParams: NavParams,\n    public userProvider: UserProvider,\n    public modalCtrl: ModalController,\n    public alertProvider: AlertProvider,\n    public disciplinesProvider: DisciplinesProvider,\n    private notifications: NotificationsProvider,\n    public menuCtrl: MenuController,\n    private fileProvider: FileProvider\n  ) {\n    this.userAuth();\n    this.disciplinesProvider.findAll().subscribe(\n      data => this.disciplines = data\n    );\n\n    let _emailVerified = this.navParams.data.emailVerified;\n    if(_emailVerified !== undefined){\n\n      let {emailVerified, displayName, aFuid } = this.navParams.data;\n      if(!emailVerified){\n        this.userProvider.checkEmailIsVerified()\n          .then((res) => {\n            this.emailVerified = res;\n            this.alertProvider.showEmailVerifiedMessage();\n            this.menuCtrl.enable(this.emailVerified, 'mainMenu');\n          })\n          .catch((error) => {\n            console.error(error)\n          });\n      }\n    }else{\n      //not coming from SIGNUP page\n      console.log('not coming from SIGNUP page')\n    }\n\n  }\n\n  changeProfileImg(){\n    let profileImgName = this.userData.profileImg.fileName || null;\n    let timestamp = moment().valueOf()+Math.floor((Math.random() * 100) + 1);\n    this.fileProvider.openGallery(timestamp, this.userData.settings.displayName)\n      .then((res) => {\n        let data = {\n          profileImg:{\n            fileName: res.fileName,\n            url: res.url\n          }\n        }\n        this.userProvider.updateUserData(data);\n        if(profileImgName){\n          this.fileProvider.delete(profileImgName);\n        }\n      })\n      .catch((err) => console.log(err));\n  }\n\n  uploadProfileImg(){\n    //this.fileProvider.uploadImage('default.png');\n  }\n  getProfileImg(){\n    this.fileProvider.getUrl('default.png');\n  }\n\n\n  presentProfileModal() {\n    let profileModal = this.modalCtrl.create('ProfileEditModalPage', { user: this.currentUser, profile: this.userData.settings } );\n    profileModal.onDidDismiss(profile => {\n      if(profile != null && profile != 'cancel'){\n        let aFuid = this.currentUser.uid;\n\n        let userData = {...this.currentUser.providerData[0], ...{'aFuid': aFuid, settings: profile } };\n        console.log('send user tags');\n        let tags = profile;\n        tags.user_id = aFuid;\n        this.sendUserTags(tags);\n        this.userProvider.updateUserData(userData).subscribe((data) => {\n          //TODO\n          //Handle errors\n        });\n      }\n    });\n    profileModal.present();\n  }\n\n  imageHasLoaded(){\n    console.log('onload');\n    this.profileImgLoaded = true;\n  }\n\n  userAuth(){\n    this.userProvider.afAuth.authState.subscribe((_user: firebase.User) => {\n      if (_user) {\n        this.userProvider.getUserData().subscribe((data) => {\n          this.userData = data;\n          this.displayName = (data.settings && data.settings.displayName) ? data.settings.displayName : _user.displayName;\n          if(data.profileImg && data.profileImg.url){\n            this.profileImg = data.profileImg.url;\n          }else if(data.photoURL){\n            this.profileImg = data.photoURL;\n          }else{\n            this.profileImg = './assets/img/man.svg';\n          }\n        });\n        this.emailVerified =  (_user.providerData[0].providerId == 'facebook.com') ? true : _user.emailVerified;\n        this.currentUser = _user;\n        this.menuCtrl.enable(this.emailVerified, 'mainMenu');\n      }\n    });\n  }\n\n\n  sendUserTags(values: any) {\n    let { age, city, gender } = values;\n    let tags = { age, city, gender, user_name:values.displayName, user_level:values.level };\n    for (let discipline of this.disciplines) {\n      let _disciplines = (values.disciplines == '') ? [] : values.disciplines ;\n      tags[discipline.alias] = _disciplines.filter( disciplineVal => disciplineVal == discipline.name )[0] || '';\n    }\n    if(Object.keys(tags).length){\n      this.notifications.tagUser(tags);\n    }\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/profile/profile.ts"],"sourceRoot":""}