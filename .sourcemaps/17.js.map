{"version":3,"sources":["../../src/pages/messages/messages.module.ts","../../src/pages/messages/messages.ts"],"names":[],"mappings":"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","file":"17.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { MessagesPage } from './messages';\nimport { TranslateModule } from '@ngx-translate/core';\nimport { MomentModule } from 'angular2-moment';\n\n@NgModule({\n  declarations: [\n    MessagesPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(MessagesPage),\n    TranslateModule.forChild(),\n    MomentModule\n  ],\n})\nexport class MessagesPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/messages/messages.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams } from 'ionic-angular';\n\nimport { Observable } from 'rxjs/Observable';\nimport { takeUntil } from 'rxjs/operators';\nimport { Subject } from 'rxjs/Subject';\n\nimport { AngularFireAuth } from 'angularfire2/auth';\n\nimport { UserProvider, BuddiesProvider, UtilsProvider, MessagesProvider } from '../../providers';\n\n//https://www.skcript.com/svr/how-to-structure-firebase-database-for-a-scalable-chat-app/\n\n\n@IonicPage()\n@Component({\n  selector: 'page-messages',\n  templateUrl: 'messages.html',\n})\nexport class MessagesPage {\n\n  activeMenu = 'MessagesPage';\n  buddies = [];\n  messages = [];\n  user;\n  private ngUnsubscribe:Subject<void> = new Subject();\n\n  constructor(\n    private buddiesProvider: BuddiesProvider,\n    private afAuth: AngularFireAuth,\n    private userProvider: UserProvider,\n    public navCtrl: NavController,\n    public navParams: NavParams,\n    public utils: UtilsProvider,\n    public messagesProvider: MessagesProvider\n  ) {\n    console.log(this);\n    this.buddiesProvider.buddies.takeUntil(this.ngUnsubscribe).subscribe((buddies) => {\n      this.buddies = buddies;\n    });\n\n    if(this.userProvider.userObject){\n      this.getMessages(this.userProvider.userObject);\n    }\n\n    this.userProvider.getUser().takeWhile(user => !this.user).subscribe(user => {\n      if(user){\n        this.getMessages(user);\n      }\n    });\n  }\n\n  ionViewDidLeave(){\n    this.ngUnsubscribe.next();\n    this.ngUnsubscribe.complete();\n  }\n\n  getMessages(user){\n    this.user = user;\n    this.messagesProvider.getAllThreads(this.user.aFuid)\n      .takeUntil(this.ngUnsubscribe)\n      .subscribe( (threads) => {\n        threads.forEach((thread, index) => {\n          let bud;\n          if(this.buddies.length && ( bud = this.buddies.find(bud => bud.aFuid == thread.key) ) ){\n            thread.displayName = bud.displayName;\n            this.messages.splice(index, 0, thread);\n          }else{\n            this.fetchUsername(thread, index);\n          }\n        });\n    });\n  }\n\n  fetchUsername(thread, index){\n    this.buddiesProvider.getUserByID(thread.key)\n      .take(1)\n      .subscribe( (user) => {\n        thread.displayName = this.utils.getDisplayName(user);\n        thread.profileImgPath = this.utils.getProfileImg(user);\n        this.messages.splice(index, 0, thread);\n      });\n  }\n\n  updateUrl(event: Event, array, index) {\n    array[index].profileImgPath = './assets/img/man.svg';\n  }\n\n  showMessage(message){\n    this.navCtrl.push('MessageThreadPage', {message, me:this.user});\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/messages/messages.ts"],"sourceRoot":""}