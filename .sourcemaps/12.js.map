{"version":3,"sources":["../../src/pages/profile/profile.module.ts","../../src/pages/profile/profile.ts"],"names":[],"mappings":"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","file":"12.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { ProfilePage } from './profile';\nimport { TranslateModule } from '@ngx-translate/core';\nimport { MomentModule } from 'angular2-moment';\n\n@NgModule({\n  declarations: [\n    ProfilePage,\n  ],\n  imports: [\n    IonicPageModule.forChild(ProfilePage),\n    TranslateModule.forChild(),\n    MomentModule\n  ],\n  exports: [\n    ProfilePage\n  ]\n})\nexport class ProfilePageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/profile/profile.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams, ModalController, MenuController } from 'ionic-angular';\nimport { takeUntil } from 'rxjs/operators';\nimport { Subject } from 'rxjs/Subject';\n\nimport { UserProvider, AlertProvider, NotificationsProvider, FileProvider, UtilsProvider } from '../../providers';\n\nimport * as firebase from 'firebase/app';\nimport * as moment  from 'moment';\n\n\n@IonicPage()\n@Component({\n  selector: 'page-profile',\n  templateUrl: 'profile.html',\n})\nexport class ProfilePage {\n\n  activeMenu = 'ProfilePage';\n  isAnyProfile:boolean = false;\n  showMap:boolean = false;\n  profileViewData:any = null;\n  private ngUnsubscribe:Subject<void> = new Subject(); \n  private userData:any;\n  private profileImg:string = null;\n  private profileImgLoaded:boolean = false;\n  private displayName:string = null;\n  private currentUser:firebase.User;\n  private emailVerified:boolean = false;\n  public disciplines: ReadonlyArray<any>;\n  public countries: ReadonlyArray<any>;\n\n  constructor(\n    public navCtrl: NavController,\n    public navParams: NavParams,\n    public userProvider: UserProvider,\n    public modalCtrl: ModalController,\n    public alertProvider: AlertProvider,\n    private notifications: NotificationsProvider,\n    public menuCtrl: MenuController,\n    private fileProvider: FileProvider,\n    public utils: UtilsProvider\n  ) {\n    (!this.utils.countries) ? this.utils.getCountries().then(res => this.countries = res) : this.countries = this.utils.countries;\n    (!this.utils.disciplines) ? this.utils.getDisciplines().then(res => this.disciplines = res) : this.disciplines = this.utils.disciplines;\n    this.userAuth();\n\n\n    if(this.navParams.data.emailVerified !== undefined){\n\n      let emailVerified = this.navParams.data.emailVerified;\n      if(!emailVerified){\n        this.userProvider.checkEmailIsVerified()\n          .then((res) => {\n            this.emailVerified = res;\n            this.alertProvider.showEmailVerifiedMessage();\n            this.menuCtrl.enable(this.emailVerified, 'mainMenu');\n          })\n          .catch((error) => {\n            console.error(error)\n          });\n      }\n    }else{\n      //not coming from SIGNUP page\n      //console.log('not coming from SIGNUP page')\n    }\n    if(this.navParams.get('isAnyProfile')){\n      this.isAnyProfile = this.navParams.get('isAnyProfile');\n      this.showMap = this.navParams.get('showMap');\n    }\n\n  }\n\n  ionViewDidLeave(){\n    this.ngUnsubscribe.next();\n    this.ngUnsubscribe.complete();\n  }\n\n  openMap(){\n    let data = {\n      state: 'display_trackers',\n      key: null,\n      values: null,\n      page:'MapPage',\n      userId: this.currentUser.uid,\n      buddy: this.profileViewData\n    }\n    this.modalCtrl\n      .create('ModalNavPage', data)\n      .present();\n  }\n\n  sendMessage(){\n    //TODO: MESSAGE ROUTE\n    console.log('send message');\n  }\n\n  changeProfileImg(){\n    let profileImgName = this.profileViewData.profileImg.fileName || null;\n    let timestamp = moment().valueOf()+Math.floor((Math.random() * 100) + 1);\n    this.fileProvider.openGallery(timestamp, this.profileViewData.settings.displayName)\n      .then((res) => {\n        let data = {\n          profileImg:{\n            fileName: res.fileName,\n            url: res.url\n          }\n        }\n        this.userProvider.updateUserData(data);\n        if(profileImgName){\n          this.fileProvider.delete(profileImgName);\n        }\n      })\n      .catch((err) => console.log(err));\n  }\n\n  uploadProfileImg(){\n    //this.fileProvider.uploadImage('default.png');\n  }\n  getProfileImg(){\n    this.fileProvider.getUrl('default.png');\n  }\n\n\n  presentProfileModal() {\n\n    let profileModal = this.modalCtrl.create('ProfileEditModalPage', { user: this.currentUser, profile: this.profileViewData.settings } );\n    profileModal.onDidDismiss(profile => {\n      if(profile != null && profile != 'cancel'){\n        let aFuid = this.currentUser.uid;\n        let userData = {...this.currentUser.providerData[0], ...{'aFuid': aFuid, settings: profile } };\n        let tags = profile;\n        tags.user_id = aFuid;\n        this.sendUserTags(tags);\n        this.userProvider.updateUserData(userData).takeUntil(this.ngUnsubscribe).subscribe((data) => {\n          //TODO\n          //Handle errors\n          //console.log('updateUserData', data);\n        });\n      }\n    });\n    profileModal.present();\n  }\n\n  imageHasLoaded(){\n    this.profileImgLoaded = true;\n  }\n\n  userAuth(){\n    this.userProvider.afAuth.authState.takeUntil(this.ngUnsubscribe).subscribe((_user: firebase.User) => {\n      if (_user) {\n        this.userProvider.getUserData().takeUntil(this.ngUnsubscribe).subscribe((data) => {\n          console.log('userData', data);\n\n          if(!this.isAnyProfile){\n            this.profileViewData = this.utils.buildProfile(data, this.disciplines, this.countries, _user);\n          }else{\n            let userData = this.navParams.get('userProfile');\n            if(!userData.profileImgPath){\n              this.profileViewData = this.utils.buildProfile(userData, this.disciplines, this.countries);\n            }else{\n              this.profileViewData = userData;\n            }\n\n            if(!this.profileViewData.location){\n              this.showMap = false;\n            }\n          }\n          this.emailVerified = this.profileViewData.emailVerified;\n\n          this.currentUser = _user;\n\n          this.menuCtrl.enable(this.emailVerified, 'mainMenu');\n        });\n      }\n    });\n  }\n\n\n  getDisciplinesAliases(disciplines){\n    let aliases = {};\n    for (let discipline of this.disciplines) {\n      let _disciplines = (disciplines == '') ? [] : disciplines ;\n      aliases[discipline.alias] = _disciplines.filter( disciplineVal => disciplineVal == discipline.alias )[0] || '';\n    }\n    return aliases;\n  }\n  sendUserTags(values: any) {\n    let { age, city, gender, displayName, level, country } = values;\n    let tags = { age, city, country, gender, user_name:displayName, user_level:level };\n    let aliases = this.getDisciplinesAliases(values.disciplines);\n    tags = Object.assign(tags, aliases);\n\n    if(Object.keys(tags).length){\n      this.notifications.tagUser(tags);\n    }\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/profile/profile.ts"],"sourceRoot":""}