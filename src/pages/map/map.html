<ion-header>
  <ion-navbar>
    <ion-buttons *ngIf="state == 'create'" start>
      <button ion-button icon-left (click)="dismiss()">
        <ion-icon name="arrow-back"></ion-icon>
        Cancel
      </button>
    </ion-buttons>
    <!-- <ion-title>Map</ion-title> -->
    <ion-buttons end>
      <button ion-button icon-right (click)="onSave()">
        Save
        <ion-icon name="lr-add-location"></ion-icon>
      </button>
    </ion-buttons>
  </ion-navbar>

</ion-header>


<ion-content no-padding>

  <div class="searchblock">
    <ion-toolbar [hidden]="!mapAPI_loaded" no-padding transparent >
      <ion-searchbar
        color="dark"
        (ionInput)="searchAutocomplete($event)"
        [showCancelButton]=true
        (ionCancel)="onCancelSearch($event)"
        (ionClear)="onCancelSearch($event)"
        [debounce]="500"
        placeholder="search for location"
        name="search"
        animated=true
        cancelButtonText="cancel"
        #search>
      </ion-searchbar>
      <ion-list no-margin>
        <ion-item tappable *ngFor="let item of autocompleteItems; let i = index" (click)="geocodePlaceId(item.place_id)">
          {{ item.description }}
        </ion-item>
      </ion-list>
    </ion-toolbar>

  </div>


  <ion-fab [hidden]="!mapAPI_loaded" bottom right>
    <button color="brand" ion-fab class="fab-map" mini (click)="setCurrentPosition()">
      <ion-icon name="ios-navigate-outline"></ion-icon>
    </button>
  </ion-fab>


  <agm-map
    #gm
    [latitude]="map.lat"
    [longitude]="map.lng"
    [zoom]="map.zoom"
    (mapClick)="mapClicked($event)"
    [streetViewControl]="false"
    [zoomControlOptions]="zoomControlOptions"
    [styles]="mapStyle"
    >
    <!-- [disableDefaultUI]="false"
    [zoomControl]="false" -->


    <agm-marker
        (markerClick)="clickedMarker(marker.label)"
        [latitude]="marker.lat"
        [longitude]="marker.lng"
        [markerDraggable]="true"
        (dragEnd)="markerDragEnd(marker, $event)"
        [iconUrl]="'assets/img/pin.png'"
        >
        <!-- [label]="marker.label" -->

      <agm-info-window *ngIf="marker.name">
        <strong>{{marker.name}}</strong>
      </agm-info-window>

    </agm-marker>

  </agm-map>
</ion-content>
